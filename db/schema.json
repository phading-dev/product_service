[{
  "spannerDatabase": {
    "name": "ProductDatabase",
    "tables": [{
      "name": "Season",
      "columns": [{
        "name": "seasonId",
        "type": "string"
      }, {
        "name": "publisherId",
        "type": "string"
      }, {
        "name": "name",
        "type": "string"
      }, {
        "name": "description",
        "type": "string"
      }, {
        "name": "coverImagePath",
        "type": "string"
      }, {
        "name": "createdTimestamp",
        "type": "timestamp",
        "allowCommitTimestamp": true
      }],
      "primaryKeys": ["seasonId"],
      "indexes": [{
        "name": "ByCreatedTimestamp",
        "columns": [{
          "name": "createdTimestamp",
          "desc": true
        }]
      }]
    }, {
      "name": "SeasonGrade",
      "columns": [{
        "name": "seasonId",
        "type": "string"
      }, {
        "name": "startTimestamp",
        "type": "timestamp"
      }, {
        "name": "endTimestamp",
        "type": "timestamp"
      }, {
        "name": "grade",
        "type": "float64",
        "comment": "Grade from 1 to 99. A multiplier on the base price."
      }],
      "primaryKeys": ["seasonId", "startTimestamp"],
      "interleave": {
        "parentTable": "Season",
        "cascadeOnDelete": true
      },
      "indexes": [{
        "name": "ByEndTimestamp",
        "columns": [{
          "name": "endTimestamp",
          "desc": true
        }]
      }]
    }, {
      "name": "Episode",
      "columns": [{
        "name": "seasonId",
        "type": "string"
      }, {
        "name": "episodeId",
        "type": "string"
      }, {
        "name": "publisherId",
        "type": "string"
      }, {
        "name": "name",
        "type": "string"
      }, {
        "name": "description",
        "type": "string"
      }, {
        "name": "videoPath",
        "type": "string",
        "nullable": true
      }, {
        "name": "videoLength",
        "type": "float64",
        "nullable": true
      }, {
        "name": "createdTimestamp",
        "type": "timestamp",
        "allowCommitTimestamp": true
      }, {
        "name": "scheduledPublishTimestamp",
        "type": "timestamp"
      }],
      "primaryKeys": ["episodeId"],
      "indexes": [{
        "name": "FromSeasonId",
        "columns": ["seasonId"]
      }, {
        "name": "ByCreatedTimestamp",
        "columns": [{
          "name": "createdTimestamp",
          "desc": true
        }]
      }, {
        "name": "ByPublishedTimestamp",
        "columns": [{
          "name": "scheduledPublishTimestamp",
          "desc": true
        }]
      }]
    }],
    "selects": [{
      "name": "GetEpisodeAndSeason",
      "table": {
        "name": "Episode",
        "as": "e"
      },
      "join": [{
        "type": "INNER",
        "table": {
          "name": "Season",
          "as": "s"
        },
        "on": {
          "op": "=",
          "leftColumn": {
            "name": "seasonId",
            "table": "e"
          },
          "rightColumn": "seasonId"
        }
      }, {
        "type": "INNER",
        "table": {
          "name": "SeasonGrade",
          "as": "sg"
        },
        "on": {
          "op": "=",
          "leftColumn": {
            "name": "seasonId",
            "table": "s"
          },
          "rightColumn": "seasonId"
        }
      }],
      "where": {
        "op": "AND",
        "left": {
          "op": "=",
          "leftColumn": {
            "name": "episodeId",
            "table": "e"
          }
        },
        "right": {
          "op": "AND",
          "left": {
            "op": ">=",
            "leftColumn": {
              "name": "startTimestamp",
              "table": "sg"
            }
          },
          "right": {
            "op": "<=",
            "leftColumn": {
              "name": "endTimestamp",
              "table": "sg"
            }
          }
        }
      },
      "getColumns": [{
        "name": "videoPath",
        "table": "e"
      }, {
        "name": "seasonId",
        "table": "s"
      }, {
        "name": "name",
        "table": "s"
      }, {
        "name": "description",
        "table": "s"
      }, {
        "name": "coverImagePath",
        "table": "s"
      }, {
        "name": "publisherId",
        "table": "s"
      }, {
        "name": "grade",
        "table": "sg"
      }]
    }, {
      "name": "GetAllEpisodes",
      "table": {
        "name": "Episode",
        "as": "e"
      },
      "join": [{
        "type": "INNER",
        "table": {
          "name": "Season",
          "as": "s"
        },
        "on": {
          "op": "=",
          "leftColumn": {
            "name": "seasonId",
            "table": "e"
          },
          "rightColumn": "seasonId"
        }
      }, {
        "type": "INNER",
        "table": {
          "name": "Episode",
          "as": "es"
        },
        "on": {
          "op": "=",
          "leftColumn": {
            "name": "seasonId",
            "table": "s"
          },
          "rightColumn": "seasonId"
        }
      }],
      "where": {
        "op": "AND",
        "left": {
          "op": "=",
          "leftColumn": {
            "name": "episodeId",
            "table": "e"
          }
        },
        "right": {
          "op": "<=",
          "leftColumn": {
            "name": "scheduledPublishTimestamp",
            "table": "es"
          }
        }
      },
      "orderBy": [{
        "column": {
          "name": "scheduledPublishTimestamp",
          "table": "es"
        },
        "desc": true
      }],
      "getColumns": [{
        "name": "episodeId",
        "table": "es"
      }, {
        "name": "name",
        "table": "es"
      }, {
        "name": "videoLength",
        "table": "es"
      }, {
        "name": "scheduledPublishTimestamp",
        "table": "es"
      }]
    }],
    "outputDdl": "./db/ddl",
    "outputSql": "./db/sql"
  }
}]
